# MCP Server Architecture Diagram

## System Overview

```
???????????????????????????????????????????????????????????????????????
? USER INTERACTION              ?
???????????????????????????????????????????????????????????????????????
       ?
        ?
???????????????????????????????????????????????????????????????????????
?  VS Code / GitHub Copilot Chat    ?
?         ?
?  User types: @aws-textract-processor Check Textract status          ?
??
?  Copilot interprets and decides to call MCP server   ?
???????????????????????????????????????????????????????????????????????
 ?
         JSON-RPC 2.0 over stdin/stdout
          ?
  ?
???????????????????????????????????????????????????????????????????????
?     MCP SERVER (This Project) ?
?  ????????????????????????????????????????????????????????????????? ?
?  ?   JsonRpcServer.cs   ? ?
?  ?   • Handles JSON-RPC protocol         ? ?
?  ?   • Processes: initialize, tools/list, tools/call         ? ?
?  ?   • Routes requests to appropriate tools     ? ?
?  ????????????????????????????????????????????????????????????????? ?
?           ?        ?
?          ?????????????????????????????        ?
?             ?   ?         ? ?
?              ?    ?             ?    ?
?  ???????????????? ???????????????? ???????????????? ????????????? ?
?  ? Textract     ? ? S3 File      ? ? Document     ? ?Calculator ? ?
?  ? Status Tool  ? ? List Tool    ? ? Process Tool ? ?   Tool    ? ?
?  ???????????????? ???????????????? ???????????????? ????????????? ?
???????????????????????????????????????????????????????????????????????
    ?
            ?????????????????????????????
    ?     ?             ?
       ?   ?             ?
???????????????????? ??????????????? ????????????????????
?   AWS Textract   ? ?   AWS S3    ? ?  AWS Bedrock     ?
?       ? ?   ? ?                  ?
?  • Document OCR  ? ? • File List ? ? • AI Processing  ?
?  • Table Extract ? ? • Download  ? ? • Data Extract   ?
?  • Form Data   ? ? • Upload    ? ? • Schema Mapping ?
???????????????????? ??????????????? ????????????????????
```

## Communication Flow

```
Step 1: Initialization
???????????????????????

VS Code/Copilot        MCP Server
      ?    ?
      ?  initialize      ?
      ??????????????????????>?
      ?           ?
  ?  capabilities        ?
      ?<??????????????????????
      ?          ?


Step 2: Tool Discovery
???????????????????????

VS Code/Copilot   MCP Server
      ?     ?
      ?  tools/list   ?
      ??????????????????????>?
  ?      ?
  ?  [tool definitions]  ?
      ?<??????????????????????
      ?               ?


Step 3: Tool Execution
???????????????????????

VS Code/Copilot          MCP Server          AWS Services
      ?  ?         ?
      ?  tools/call  ?       ?
      ?  (textract_status)   ?           ?
      ??????????????????????>?    ?
      ? ?  API Call        ?
      ?    ?????????????????????>?
      ?           ?          ?
    ?           ?  Response ?
      ? ?<?????????????????????
      ?  Result              ?     ?
      ?<??????????????????????      ?
      ?         ?         ?
```

## Data Flow Example: Process Document

```
1. User Input
   ???????????????????????????????????????????????
   ? @aws-textract-processor                     ?
   ? Process s3://bucket/file.pdf?
   ???????????????????????????????????????????????
     ?
               ?
2. Copilot Interpretation
   ???????????????????????????????????????????????
   ? Parse: Need to call document_process tool   ?
   ? Parameters: {bucket, key}    ?
   ???????????????????????????????????????????????
   ?
       ?
3. MCP Server Receives
   ???????????????????????????????????????????????
   ? {"jsonrpc":"2.0","method":"tools/call",     ?
   ?  "params":{"name":"document_process",       ?
   ?            "arguments":{...}}}   ?
   ???????????????????????????????????????????????
           ?
   ?
4. Tool Execution
   ???????????????????????????????????????????????
   ? DocumentProcessTool.ExecuteAsync()  ?
   ?  ?? Validate parameters     ?
   ?  ?? Download from S3                  ?
   ?  ?? Call Textract         ?
   ?  ?? Wait for completion       ?
   ?  ?? Process with Bedrock      ?
   ?  ?? Return structured result                ?
   ???????????????????????????????????????????????
   ?
          ?
5. AWS Services
   ????????????????  ????????????????  ????????????????
   ?     S3?? ?   Textract   ?? ?   Bedrock    ?
   ?  Get File    ?  ?  OCR & Parse ?  ? AI Extract   ?
   ????????????????  ????????????????  ????????????????
           ?
      ?
6. Result Back to User
   ???????????????????????????????????????????????
   ? Formatted response in Copilot Chat:       ?
   ??
   ? ? Document processed successfully      ?
   ? • Extracted text: ... ?
   ? • Form fields: ...      ?
   ? • Tables: ...       ?
   ???????????????????????????????????????????????
```

## Tool Architecture

```
IMcpTool Interface
    ?
    ?? Name: string
    ?? Description: string
    ?? InputSchema: ToolInputSchema
    ?? ExecuteAsync(parameters): Task<object>
    ?
        ? Implemented by:
    ?
    ??????????????????????????????????????????????????????????
 ?   ?           ?    ?
    ?   ?                 ?     ?
TextractStatusTool  S3FileListTool  DocumentProcessTool  CalculatorTool
    ?     ?      ?         ?
    ??????????????????????????????????????????????????????????
 ?
      ?
    Common Response Format:
    ??????????????????????????
   ? { ?
      ?   "content": [{        ?
       ?     "type": "text",    ?
                  ? "text": "..."      ?
  ?   }]             ?
         ? }   ?
  ??????????????????????????
```

## Configuration Flow

```
Developer      VS Code    MCP Server
    ?    ?            ?
    ? 1. Edit      ?    ?
    ? settings.json         ?     ?
    ???????????????????????>? ?
    ?            ?            ?
    ? 2. Restart            ?   ?
    ? VS Code               ? ?
    ???????????????????????>?              ?
    ?           ?   ?
    ?    ? 3. Load config       ?
    ?          ? & start server       ?
    ?     ??????????????????????>?
    ?        ?    ?
    ?     ? 4. Server ready ?
    ?  ?<??????????????????????
    ?          ?        ?
    ? 5. Use Copilot   ?        ?
    ? with @server-name     ?   ?
  ???????????????????????>?  ?
    ?      ?    ?
    ?? 6. Forward request   ?
    ?  ??????????????????????>?
    ?       ?    ?
    ?             ? 7. Execute & respond ?
    ? 8. Display result     ?<??????????????????????
    ?<???????????????????????     ?
    ?           ?         ?
```

## Error Handling Flow

```
User Request
    ?
    ?
?????????????????
? Input Valid?  ?
?????????????????
  ? No
    ?????????> Return: Parameter validation error
        ?
  ? Yes
        ?
?????????????????
? AWS Creds OK? ?
?????????????????
        ? No
        ?????????> Return: Authentication error
        ?
        ? Yes
        ?
?????????????????
?  S3 Access? ?
?????????????????
? No
        ?????????> Return: Permission denied
  ?
        ? Yes
        ?
?????????????????
? Service OK?   ?
?????????????????
        ? No
        ?????????> Return: Service unavailable
        ?
        ? Yes
        ?
?????????????????
?  Execute Tool ?
?      ?
?  Success ?    ?
?????????????????
```

## Deployment Options

```
Option 1: Development (Current)
???????????????????????????????
VS Code ? dotnet run ? Source Code
          (Live compilation)

Pros: Easy to modify and test
Cons: Requires .NET SDK, slower startup


Option 2: Published Executable
???????????????????????????????
VS Code ? MCPServer.exe ? Compiled Binary
          (Pre-compiled)

Pros: Faster startup, no SDK needed
Cons: Need to rebuild after changes

Command: dotnet publish -c Release -r win-x64 --self-contained


Option 3: Container (Advanced)
???????????????????????????????
VS Code ? Docker ? MCPServer Container
          (Isolated environment)

Pros: Consistent environment, easy distribution
Cons: Requires Docker, more complex setup
```

## Security Architecture

```
???????????????????????????????????????????????
?            Security Layers       ?
???????????????????????????????????????????????
?  ?
?  1. Process Isolation ?
?     • MCP server runs in separate process   ?
?     • No direct memory access to VS Code    ?
?          ?
?  2. Communication Security         ?
?     • stdin/stdout only  ?
?     • JSON-RPC protocol validation   ?
?     • No network exposure       ?
?     ?
?  3. AWS Security       ?
?     • Uses AWS credential chain   ?
?     • IAM permissions enforced    ?
?     • No hardcoded credentials    ?
??
?  4. Input Validation      ?
?     • Parameter type checking    ?
?     • Schema validation        ?
?  • Sanitization of user input        ?
?   ?
?  5. Error Handling     ?
?     • No sensitive data in errors ?
?     • Graceful degradation              ?
?     • Logging to stderr only   ?
?         ?
???????????????????????????????????????????????
```

---

**Legend:**
- `?` Vertical connection
- `?` Horizontal connection
- `?` Flow direction
- `???` Box/Component
- `???` Box/Component
- `?` Arrow/Direction
